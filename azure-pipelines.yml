trigger: none

schedules:
- cron: "0 0 * * *"
  displayName: Daily midnight test
  branches:
    include:
    - master

pool:
  name: Docker-pool

resources:
   containers:
     - container: pre_prime
       image: dfdsdk/prime-pipeline:0.3.7
       env:
        AWS_SECRET_ACCESS_KEY: $(AWS_SECRET_ACCESS_KEY)

container: qa
variables:
- group: QA
steps:
- bash:
      echo 'Checking for AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY...'
      bash -c '[[ -z $AWS_ACCESS_KEY_ID || -z $AWS_SECRET_ACCESS_KEY ]] && exit 1 || true'
  displayName: Testing environment variables
- bash: 
      echo terragrunt apply-all --terragrunt-working-dir ./test/integration --terragrunt-source-update --terragrunt-non-interactive -input=false -auto-approve
  displayName: Integration test against QA
